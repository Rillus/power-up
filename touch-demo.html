<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Touch Controls Demo - Power Up Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #demo-canvas {
            border: 1px solid #444;
            display: block;
            margin: 0 auto;
            background: #333;
        }
        
        .info {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            max-width: 300px;
        }
        
        .status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
        
        .player {
            background: #0066CC;
            border-radius: 50%;
            position: absolute;
            width: 20px;
            height: 20px;
            transition: all 0.1s ease;
        }
    </style>
</head>
<body>
    <div class="info">
        <h3>Touch Controls Demo</h3>
        <p><strong>Instructions:</strong></p>
        <ul>
            <li>Virtual joystick (bottom-left): Move player</li>
            <li>R button (bottom-right): Repair action</li>
            <li>Menu button: Open menu</li>
            <li>Press T to toggle touch controls on desktop</li>
        </ul>
    </div>
    
    <div class="status" id="status">
        Status: Initializing...
    </div>
    
    <canvas id="demo-canvas" width="800" height="600"></canvas>
    
    <script type="module">
        import { TouchControlSystem } from './src/systems/TouchControlSystem.js';
        
        class TouchDemo {
            constructor() {
                this.canvas = document.getElementById('demo-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.statusEl = document.getElementById('status');
                
                // Mock input system for demo
                this.inputSystem = {
                    keys: {},
                    simulateKeyPress: (key) => {
                        this.keys[key] = true;
                        console.log('Key pressed:', key);
                    },
                    simulateKeyRelease: (key) => {
                        this.keys[key] = false;
                        console.log('Key released:', key);
                    }
                };
                
                // Player state
                this.player = {
                    x: 400,
                    y: 300,
                    size: 20,
                    speed: 200 // pixels per second
                };
                
                // Initialize touch controls
                this.touchControls = new TouchControlSystem(this.canvas, this.inputSystem);
                
                // Bind keyboard events for desktop testing
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'KeyT') {
                        this.touchControls.toggle();
                        this.updateStatus();
                    }
                });
                
                // Start demo loop
                this.lastTime = 0;
                this.updateStatus();
                this.gameLoop();
            }
            
            updateStatus() {
                const status = this.touchControls.getStatus();
                this.statusEl.innerHTML = `
                    <strong>Touch Controls Status:</strong><br>
                    Enabled: ${status.enabled}<br>
                    Mobile Device: ${status.isMobile}<br>
                    Joystick Active: ${status.joystickActive}<br>
                    Active Buttons: ${status.activeButtons.join(', ') || 'None'}<br>
                    <br>
                    <strong>Current Input:</strong><br>
                    W: ${this.inputSystem.keys.KeyW || false}<br>
                    A: ${this.inputSystem.keys.KeyA || false}<br>
                    S: ${this.inputSystem.keys.KeyS || false}<br>
                    D: ${this.inputSystem.keys.KeyD || false}<br>
                    R: ${this.inputSystem.keys.KeyR || false}
                `;
            }
            
            update(deltaTime) {
                // Update touch controls
                this.touchControls.update(deltaTime);
                
                // Move player based on input
                const speed = this.player.speed * (deltaTime / 1000);
                
                if (this.inputSystem.keys.KeyW) this.player.y -= speed;
                if (this.inputSystem.keys.KeyS) this.player.y += speed;
                if (this.inputSystem.keys.KeyA) this.player.x -= speed;
                if (this.inputSystem.keys.KeyD) this.player.x += speed;
                
                // Keep player in bounds
                this.player.x = Math.max(this.player.size/2, Math.min(this.canvas.width - this.player.size/2, this.player.x));
                this.player.y = Math.max(this.player.size/2, Math.min(this.canvas.height - this.player.size/2, this.player.y));
                
                // Update status display
                this.updateStatus();
            }
            
            render() {
                // Clear canvas
                this.ctx.fillStyle = '#333333';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw grid
                this.ctx.strokeStyle = '#444444';
                this.ctx.lineWidth = 1;
                for (let x = 0; x <= this.canvas.width; x += 40) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                for (let y = 0; y <= this.canvas.height; y += 40) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
                
                // Draw player
                this.ctx.fillStyle = '#0066CC';
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y, this.player.size/2, 0, 2 * Math.PI);
                this.ctx.fill();
                
                // Draw player direction indicator
                if (this.inputSystem.keys.KeyW || this.inputSystem.keys.KeyS || 
                    this.inputSystem.keys.KeyA || this.inputSystem.keys.KeyD) {
                    this.ctx.fillStyle = '#FFFFFF';
                    this.ctx.beginPath();
                    this.ctx.arc(this.player.x, this.player.y, 3, 0, 2 * Math.PI);
                    this.ctx.fill();
                }
                
                // Render touch controls using mock renderer
                const mockRenderer = {
                    context: this.ctx,
                    clear: () => {},
                    setTransform: () => {},
                    resetTransform: () => {}
                };
                
                this.touchControls.render(mockRenderer);
                
                // Draw instructions
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Move the blue circle with touch controls or WASD keys', this.canvas.width/2, 30);
                this.ctx.font = '12px Arial';
                this.ctx.fillText('Press T to toggle touch controls on desktop', this.canvas.width/2, 50);
            }
            
            gameLoop(currentTime = 0) {
                const deltaTime = currentTime - this.lastTime;
                this.lastTime = currentTime;
                
                this.update(deltaTime);
                this.render();
                
                requestAnimationFrame((time) => this.gameLoop(time));
            }
        }
        
        // Start demo when page loads
        new TouchDemo();
    </script>
</body>
</html>